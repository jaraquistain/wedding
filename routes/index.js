/* GET home page. */
var flagSVG = '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 359.9 220" xml:space="preserve" enable-background="new 0 0 359.9 220"><g class="st0"><path class="st1" d="M359.9 146c0 1.3 0 2.7 0 4 -3.5 5.4-8.4 8.9-16.1 10.4 8 2 13.4 5 16.1 11.6 0 1.7 0 3.3 0 5 -3.9 5.2-8.9 8.7-16.8 9.8 8.9 4.9 13.7 11.3 16.8 19.2 0 2.7 0 5.3 0 8 -2.1 2.2-4.3 4.4-7 6 -2.7 0-5.3 0-8 0 -7.1-3.8-13.7-8.1-18-16.9 -1.7 8.3-4.7 13.7-11 16.9 -1.7 0-3.3 0-5 0 -5.7-3.5-8.9-8.8-10.4-16.5 -1.8 8.1-4.7 13.8-11.6 16.5 -1.7 0-3.3 0-5 0 -4.7-3.6-7.9-8.3-10-14 -2.3 6.3-5.4 11.1-11 14 -1.7 0-3.3 0-5 0 -5.9-3.5-9.1-9-10.7-15.8 -1.8 7-4.7 12.7-11.3 15.8 -1.7 0-3.3 0-5 0 -5.7-3.7-8.8-9.3-10.5-15.9 -1.7 7.1-4.6 12.9-11.5 15.9 -1.7 0-3.3 0-5 0 -5.4-4-8.9-9.2-10.1-16.1 -1.5 7.1-4.8 12.6-10.9 16.1 -2 0-4 0-6 0 -4.9-4.2-8.7-9.2-9.8-16 -1.7 7-4.7 12.8-11.2 16 -1.7 0-3.3 0-5 0 -5.9-3.6-9-9.1-10.5-15.9 -1.8 7-4.6 12.9-11.5 15.9 -1.7 0-3.3 0-5 0 -5.6-3.8-8.8-9.2-10.3-15.9 -1.8 7.1-4.6 13.1-11.7 15.9 -1.7 0-3.3 0-5 0 -5.2-4-8.8-9.2-10-16 -1.4 7.2-4.9 12.5-11 16 -1.7 0-3.3 0-5 0 -5.8-3.3-8.9-8.7-10.9-15 -1.6 7.1-5.1 12-11.1 15 -1.7 0-3.3 0-5 0 -5.8-3.7-8.9-9.2-10.4-17.3 -4.3 9.3-11.3 13.5-18.6 17.3 -2.7 0-5.3 0-8 0 -3.7-2.8-6.7-5.9-6.3-11.1 0.4-4.6 2.2-8.6 4.8-12.4 2.7-3.8 6.4-6.5 10.6-9.4 -7.3-3.1-16-4.8-15.8-14.2 0.2-7.9 7.2-10.3 13.7-12.4 -1.9-2-4.6-2.1-6.7-3.5C3.4 154.7 0 151.9 0 147c0-4.8 3.3-7.8 7.2-10.1 2.9-1.7 6.2-2.3 10.1-3.5 -8.3-2.3-16.8-4.1-17.1-13.3C0 111 8.6 109 16 106.6c-2.8-1-5.2-1.6-7.5-2.7C4 101.8 0.1 98.6 0 93.2c0-5.5 3.9-8.6 8.5-10.7 2.2-1.1 4.7-1.8 7.5-2.9 -10.4-2.7-16.5-7.5-16-13C0.8 57.5 8.5 55.4 16.5 53c-8-2.3-16.4-4.4-16.3-13.6 0.1-8.7 8.4-10.8 16-13.2 -4.5-1.4-8.4-2.4-11.5-4.9 -6.2-5-6.3-11.9 0.1-16.8C8.8 1.5 13.4 0 18.7 0c106.6 0.1 213.2 0.1 319.8 0 9.1 0 16.6 2.8 21.4 11 0 1.7 0 3.3 0 5 -3.7 5.8-9.1 9.2-16.1 10.6 7.1 1.7 12.8 4.7 16.1 11.4 0 1.7 0 3.3 0 5 -3.8 5.6-9.3 8.8-15.9 10.5 7.3 1.5 12.8 4.8 15.9 11.5 0 1.7 0 3.3 0 5 -3.9 5.1-8.8 8.8-15.5 10.1 7.2 2 12.7 5.2 15.5 11.9 0 1.3 0 2.7 0 4 -3.5 5.8-8.6 9.2-15.6 10.9 7 1.5 12.3 5 15.6 11.1 0 1.7 0 3.3 0 5 -3.8 5.9-9.4 9.3-16.5 10.7C350.7 135.7 357 138.6 359.9 146zM347.1 198.9c-3.5 0.7-4.2-1.2-4.9-2.3 -3.7 0.8-5.4 3.2-5.8 6.8 1.6 0.3 3.3 1.1 3.9 3.8 1.2-2.9 2.9-2.9 5.1-2.4C344.7 202.8 344.6 201.1 347.1 198.9zM11.4 205.4c2.6 1.9 5.8 4 8.1 0.5 1.4-2.1 0.3-6.2-2.4-6.7C13.4 198.6 12 202.1 11.4 205.4zM202.5 208.5c5.5 3.3 6.2 3.2 9.2-0.8C208.5 204.9 205.6 205.1 202.5 208.5zM149 208.4c5.3 3.3 5.3 3.3 9.2-0.5C155.2 204.8 152.3 205.1 149 208.4zM347.7 116.1c-2.7 2.9-5.2 5.5-0.2 8.5C350.8 122 351.8 119.3 347.7 116.1zM347.6 17.7c3.2-2.7 4-5.4 0.1-8.5C345 12.1 342.6 14.8 347.6 17.7zM347.8 89.4c-3 3-4.9 5.7-0.3 8.5C351.4 93.8 351.4 93.8 347.8 89.4zM42.2 208.4c3.3 3 6.3 3.2 9.4-0.3C48.2 204.7 45.2 205.2 42.2 208.4zM12.3 62.1c-4.4 4.8-4.4 5 0 8.3C15 67.8 16.4 65.2 12.3 62.1zM229.5 208.4c4.7 3.3 4.7 3.3 9-0.3C233.9 204.7 233.9 204.7 229.5 208.4zM69.1 208.3c4.8 3.5 5.7 3.5 8.9-0.6C74.8 204.8 71.9 205.2 69.1 208.3zM348 36c-4.6 4.8-4.6 5-0.3 8.4C351.2 40.2 351.2 40.2 348 36zM347.7 62.6c-2.5 3-4.8 5.7-0.1 8.5C350.9 68.5 351.7 65.8 347.7 62.6zM256 208.4c5.3 3.3 5.3 3.3 9.2-0.6C262.1 204.8 259.2 205.1 256 208.4zM12.3 35.4c-4.3 4.4-4.3 4.5-0.3 8.2C15.8 39.3 15.8 39.3 12.3 35.4zM12.2 88.9C9 91.6 7.5 94.2 12 97.3 14.9 94.6 16.3 92 12.2 88.9zM11.9 150.5c3-3 4.4-5.6 0.5-8.5C8.1 146.2 8.1 146.2 11.9 150.5zM105.4 208.2c-3.6-3.1-6.5-3.3-9.4 0.1C100.2 211.5 100.2 211.5 105.4 208.2zM131.7 208.1c-3.3-3.4-6.2-3-9.3 0.3C125.6 211.3 128.6 211.6 131.7 208.1zM292.3 208.1c-3.6-3.2-6.5-3.1-9.3 0.4C286.3 211.7 289.2 211.1 292.3 208.1zM185.5 208.2c-3.4-3.3-6.3-3.3-9.5 0.2C180.5 211.4 180.5 211.4 185.5 208.2zM318.8 208.2c-3.5-3.9-6.4-2.8-9.4 0.2C312.6 211.3 315.6 211.6 318.8 208.2zM12.3 9.1c-4.5 4.5-4.5 4.8-0.1 8.1C15 14.6 16.2 11.9 12.3 9.1zM11.8 123.5c4.1-4.3 4.1-4.7 0.1-8C8.2 119.8 8.2 119.8 11.8 123.5zM347.3 151.4c4.3-4.3 4.3-4.5 0.2-8.2C344.6 145.9 343.3 148.6 347.3 151.4zM347.2 178c4.3-4 4.3-4.7 0.2-8C345.2 172.4 343 174.8 347.2 178zM12.4 168.6c-4.5 4.4-4.5 5.3-0.1 8.1C15.3 174.1 15.8 171.4 12.4 168.6z"/></g></svg>';
exports.root = function (req, res) {
    var defaultView = 'info';
    exports[defaultView](req, res);
};

exports.info = function (req, res) {
    res.render('info', {
        'title': 'Information',
        'tab':   'Info'
    });
};
exports.rsvp = function (Invite, Guest) {
    return function (req, res) {
        Guest.find({}, function (error, guests) {
            Invite.find({}, function (error, invites) {
                res.render('rsvp', {
                    'title':   'RSVP',
                    'tab':     'RSVP',
                    'invites': invites,
                    'guests': guests
                });
            });
        });
    }
};

exports.vegas = function (req, res) {
    res.render('vegas', {
        'title': 'Vegas!',
        'tab':   'Vegas!'
    });
};

exports.registry = function (req, res) {
    res.render('registry', {
        'title': 'Registry',
        'tab':   'Registry'
    });
};

exports.index = function (Guest) {
    return function (req, res) {

        Guest.find({}, function (error, guests) {
            res.render('guest', {
                'title':  'Guest List',
                'guests': guests
            });
        });
    };
};

exports.addGuest = function (Guest) {
    return function (req, res) {
        var guest = new Guest(req.body);
        guest.save(function (error, guest) {
            if (error || !guest) {
                res.json({'error': true});
            } else {
                res.json(guest);
            }
        });
    }
};

exports.get = function (Guest) {
    return function (req, res) {
        Guest.find({}, function (error, guests) {
            res.json(guests);
        });
    }
};

exports.update = function (Guest) {
    return function (req, res) {
        Guest.findOne({'_id': req.params.id }, function (error, guest) {
            if (error || !guest) {
                res.json({'error': error});
            } else {
                for (var key in req.body) {
                    if (req.body.hasOwnProperty(key)) {
                        guest[key] = req.body[key];
                    }
                }
                guest.save(function (error, data) {
                    if (error || !data) {
                        res.json({'error': error});
                    } else {
                        res.json(data);
                    }
                });
            }
        });
    }
};